<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perfektes 3D Schachspiel</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
            color: white;
            height: 100vh;
            overflow: hidden;
            transition: all 1s ease;
        }

        /* Background Environments */
        .env-space {
            background: 
                radial-gradient(circle at 20% 30%, rgba(255, 255, 255, 0.8) 1px, transparent 1px),
                radial-gradient(circle at 80% 70%, rgba(255, 255, 255, 0.6) 1px, transparent 1px),
                radial-gradient(circle at 40% 80%, rgba(255, 255, 255, 0.4) 1px, transparent 1px),
                radial-gradient(circle at 60% 20%, rgba(255, 255, 255, 0.7) 1px, transparent 1px),
                linear-gradient(135deg, #0a0a2e 0%, #1a1a3e 50%, #2a2a4e 100%);
            animation: stars-twinkle 3s ease-in-out infinite alternate;
        }

        .env-cyberpunk {
            background: 
                linear-gradient(45deg, rgba(255, 0, 255, 0.1) 25%, transparent 25%),
                linear-gradient(-45deg, rgba(0, 255, 255, 0.1) 25%, transparent 25%),
                radial-gradient(circle at 30% 40%, rgba(255, 0, 255, 0.3) 0%, transparent 50%),
                linear-gradient(135deg, #1a0a2e 0%, #2e1a2e 50%, #3e2a1e 100%);
            background-size: 60px 60px, 60px 60px, 200px 200px, 100% 100%;
            animation: neon-pulse 2s ease-in-out infinite alternate;
        }

        .env-forest {
            background: 
                radial-gradient(circle at 25% 60%, rgba(34, 139, 34, 0.4) 20%, transparent 20%),
                radial-gradient(circle at 75% 40%, rgba(46, 125, 50, 0.3) 15%, transparent 15%),
                linear-gradient(135deg, #1b2e1b 0%, #2e4a2e 50%, #1a3a1a 100%);
            animation: forest-sway 4s ease-in-out infinite alternate;
        }

        .env-underwater {
            background: 
                radial-gradient(circle at 30% 20%, rgba(0, 191, 255, 0.3) 10%, transparent 10%),
                radial-gradient(circle at 70% 60%, rgba(0, 150, 255, 0.2) 8%, transparent 8%),
                linear-gradient(135deg, #0a1a2e 0%, #1a2a4e 50%, #0a2a3e 100%);
            animation: underwater-bubbles 3s ease-in-out infinite alternate;
        }

        .env-volcanic {
            background: 
                radial-gradient(circle at 40% 70%, rgba(255, 69, 0, 0.4) 15%, transparent 15%),
                radial-gradient(circle at 80% 30%, rgba(255, 140, 0, 0.3) 10%, transparent 10%),
                linear-gradient(135deg, #2e1a0a 0%, #4a2e1a 50%, #3a1a0a 100%);
            animation: volcanic-glow 2.5s ease-in-out infinite alternate;
        }

        @keyframes stars-twinkle {
            0% { opacity: 0.8; }
            100% { opacity: 1; }
        }

        @keyframes neon-pulse {
            0% { opacity: 0.8; }
            100% { opacity: 1; }
        }

        @keyframes forest-sway {
            0% { background-position: 0% 0%; }
            100% { background-position: 2% -2%; }
        }

        @keyframes underwater-bubbles {
            0% { background-position: 0% 0%; }
            100% { background-position: 5% -10%; }
        }

        @keyframes volcanic-glow {
            0% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        #gameContainer {
            display: flex;
            height: 100vh;
            padding: 20px;
            gap: 20px;
        }

        #chess-board {
            width: 600px;
            height: 600px;
            margin: auto;
            border: 4px solid #00ffff;
            box-shadow: 0 0 50px rgba(0, 255, 255, 0.5);
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            background: #333;
        }

        .square {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .square.light {
            background-color: #f0d9b5;
            color: #333;
        }

        .square.dark {
            background-color: #b58863;
            color: white;
        }

        .square.selected {
            background-color: #ffff00 !important;
            box-shadow: inset 0 0 20px rgba(255, 255, 0, 0.7);
        }

        .square.possible-move {
            background-color: #90EE90 !important;
        }

        .square:hover {
            opacity: 0.8;
            transform: scale(1.05);
        }

        #control-panel, #game-info {
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #00ffff;
            border-radius: 10px;
            padding: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.3);
            max-width: 300px;
            height: fit-content;
        }

        .control-group {
            margin-bottom: 15px;
        }

        .control-group label {
            display: block;
            margin-bottom: 5px;
            color: #00ffff;
            font-weight: bold;
        }

        select, button {
            background: rgba(0, 0, 0, 0.9);
            color: white;
            border: 1px solid #00ffff;
            border-radius: 5px;
            padding: 8px 12px;
            font-family: inherit;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-bottom: 5px;
        }

        select:hover, button:hover {
            background: rgba(0, 255, 255, 0.1);
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.4);
        }

        .ai-character-display {
            font-size: 48px;
            text-align: center;
            padding: 10px;
            margin: 10px 0;
            background: rgba(0, 255, 255, 0.1);
            border-radius: 10px;
            border: 2px solid rgba(0, 255, 255, 0.3);
        }

        #ai-robot-type {
            font-size: 12px;
            color: #ffaa00;
            font-style: italic;
        }

        #loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(0, 255, 255, 0.3);
            border-top: 4px solid #00ffff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 24px;
            color: #00ffff;
            text-align: center;
        }

        .title {
            font-size: 48px;
            background: linear-gradient(45deg, #00ffff, #ff6600, #00ff00);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-align: center;
            margin-bottom: 30px;
        }
    </style>
</head>
<body>
    <div id="loading-screen">
        <h1 class="title">PERFEKTES 3D SCHACH</h1>
        <div class="loading-spinner"></div>
        <div class="loading-text">Initialisiere Schach-Engine...</div>
    </div>

    <div id="gameContainer">
        <div id="control-panel">
            <div class="control-group">
                <label for="environment">Umgebung:</label>
                <select id="environment">
                    <option value="default">Standard</option>
                    <option value="space">Weltraum</option>
                    <option value="cyberpunk">Cyberpunk</option>
                    <option value="forest">Wald</option>
                    <option value="underwater">Unterwasser</option>
                    <option value="volcanic">Vulkan</option>
                </select>
            </div>

            <div class="control-group">
                <label for="board-theme">Brett-Theme:</label>
                <select id="board-theme">
                    <option value="classic">Klassisch</option>
                    <option value="cyberpunk">Cyberpunk</option>
                    <option value="crystal">Kristall</option>
                </select>
            </div>

            <div class="control-group">
                <label for="ai-character">AI-Gegner:</label>
                <select id="ai-character">
                    <option value="neon-hacker">Neon Hacker</option>
                    <option value="cyber-warrior">Cyber Warrior</option>
                    <option value="data-ghost">Data Ghost</option>
                    <option value="chrome-knight">Chrome Knight</option>
                </select>
            </div>

            <div class="control-group">
                <label for="robot-type">Roboter-Typ:</label>
                <select id="robot-type">
                    <option value="humanoid">Humanoid</option>
                    <option value="tactical">Taktisch</option>
                    <option value="combat">Kampf</option>
                    <option value="stealth">Stealth</option>
                </select>
            </div>

            <div class="control-group">
                <button id="new-game">Neues Spiel</button>
                <button id="undo">Rückgängig</button>
                <button id="hint">Hinweis</button>
            </div>
        </div>

        <div id="chess-board"></div>

        <div id="game-info">
            <h3>Spiel Status</h3>
            <div class="control-group">
                <div id="current-player">Weiß ist dran</div>
                <div id="move-count">Zug: 1</div>
                <div id="game-status">Spiel läuft</div>
            </div>

            <div class="control-group">
                <h4>AI Gegner</h4>
                <div id="ai-avatar">Neon Hacker</div>
                <div id="ai-robot-type">Humanoid Android</div>
                <div id="ai-status">Bereit</div>
                <div id="ai-visual" class="ai-character-display">🕴️🤖</div>
            </div>

            <div class="control-group">
                <h4>Letzter Zug</h4>
                <div id="last-move">Keiner</div>
            </div>
        </div>
    </div>

    <!-- Chess Engine -->
    <script src="libs/chess-mock.js"></script>
    
    <script>
        class PerfektesSchach {
            constructor() {
                this.chess = new Chess();
                this.selectedSquare = null;
                this.currentPlayer = 'white';
                this.moveHistory = [];
                this.aiThinking = false;
                
                this.init();
            }

            async init() {
                try {
                    console.log('Initialisiere Spiel...');
                    
                    // Check if chess library is loaded
                    if (typeof Chess === 'undefined') {
                        throw new Error('Chess-Bibliothek nicht geladen');
                    }

                    this.createBoard();
                    this.setupEventListeners();
                    
                    // Hide loading screen
                    setTimeout(() => {
                        this.hideLoadingScreen();
                        console.log('Spiel erfolgreich initialisiert!');
                    }, 2000);
                    
                } catch (error) {
                    console.error('Fehler bei Initialisierung:', error);
                    this.showError(`Fehler: ${error.message}`);
                }
            }

            hideLoadingScreen() {
                const loadingScreen = document.getElementById('loading-screen');
                if (loadingScreen) {
                    loadingScreen.style.opacity = '0';
                    setTimeout(() => {
                        loadingScreen.style.display = 'none';
                    }, 500);
                }
            }

            showError(message) {
                const loadingText = document.querySelector('.loading-text');
                if (loadingText) {
                    loadingText.textContent = message;
                    loadingText.style.color = '#ff0000';
                }
            }

            createBoard() {
                const board = document.getElementById('chess-board');
                board.innerHTML = '';

                for (let rank = 0; rank < 8; rank++) {
                    for (let file = 0; file < 8; file++) {
                        const square = document.createElement('div');
                        square.className = `square ${(rank + file) % 2 === 0 ? 'light' : 'dark'}`;
                        square.dataset.square = String.fromCharCode(97 + file) + (8 - rank);
                        square.addEventListener('click', () => this.handleSquareClick(square.dataset.square));
                        board.appendChild(square);
                    }
                }

                this.updateBoard();
            }

            updateBoard() {
                const pieces = {
                    'p': '♟', 'r': '♜', 'n': '♞', 'b': '♝', 'q': '♛', 'k': '♚',
                    'P': '♙', 'R': '♖', 'N': '♘', 'B': '♗', 'Q': '♕', 'K': '♔'
                };

                for (let rank = 0; rank < 8; rank++) {
                    for (let file = 0; file < 8; file++) {
                        const squareName = String.fromCharCode(97 + file) + (8 - rank);
                        const square = document.querySelector(`[data-square="${squareName}"]`);
                        const piece = this.chess.get(squareName);
                        
                        if (piece) {
                            const symbol = piece.color === 'w' ? 
                                pieces[piece.type.toUpperCase()] : 
                                pieces[piece.type.toLowerCase()];
                            square.textContent = symbol;
                        } else {
                            square.textContent = '';
                        }
                    }
                }

                // Clear highlights
                document.querySelectorAll('.square').forEach(sq => {
                    sq.classList.remove('selected', 'possible-move');
                });
            }

            handleSquareClick(square) {
                if (this.aiThinking) return;
                console.log('Feld geklickt:', square);

                if (this.selectedSquare) {
                    // Try to make a move
                    const move = this.chess.move({
                        from: this.selectedSquare,
                        to: square
                    });
                    
                    if (move) {
                        console.log('Zug gemacht:', move.san);
                        this.updateGameInfo(move);
                        this.selectedSquare = null;
                        this.updateBoard();
                        
                        // AI move
                        this.currentPlayer = 'black';
                        this.updateUI();
                        setTimeout(() => this.makeAIMove(), 1000);
                        
                        this.showNotification(`Zug: ${move.san}`);
                    } else {
                        this.showNotification('Ungültiger Zug!', 'error');
                        this.selectedSquare = null;
                        this.updateBoard();
                    }
                } else {
                    // Select a piece
                    const piece = this.chess.get(square);
                    if (piece && piece.color === 'w' && this.currentPlayer === 'white') {
                        this.selectedSquare = square;
                        this.showNotification(`${piece.type} auf ${square} ausgewählt`);
                        
                        // Highlight selected square
                        document.querySelector(`[data-square="${square}"]`).classList.add('selected');
                        
                        // Show possible moves
                        const moves = this.chess.moves({ square: square, verbose: true });
                        moves.forEach(move => {
                            if (move.to) {
                                document.querySelector(`[data-square="${move.to}"]`)?.classList.add('possible-move');
                            }
                        });
                    } else {
                        this.showNotification('Wählen Sie eine weiße Figur!', 'warning');
                    }
                }
            }

            makeAIMove() {
                if (this.aiThinking || this.chess.turn() !== 'b') {
                    return;
                }
                
                this.aiThinking = true;
                this.updateAIStatus('Denkt...');
                
                setTimeout(() => {
                    try {
                        const moves = this.chess.moves();
                        console.log('AI-Züge verfügbar:', moves.length);
                        
                        if (moves.length > 0 && this.chess.turn() === 'b') {
                            const randomMove = moves[Math.floor(Math.random() * moves.length)];
                            const move = this.chess.move(randomMove);
                            
                            if (move) {
                                console.log('AI Zug:', move.san);
                                this.updateGameInfo(move);
                                this.currentPlayer = 'white';
                                this.updateBoard();
                                this.updateUI();
                                this.showNotification(`AI spielte: ${move.san}`);
                            }
                        }
                    } catch (error) {
                        console.error('AI Fehler:', error);
                    }
                    
                    this.aiThinking = false;
                    this.updateAIStatus('Bereit');
                }, 500 + Math.random() * 1500);
            }

            updateGameInfo(move) {
                this.moveHistory.push(move);
                
                document.getElementById('last-move').textContent = move.san;
                document.getElementById('move-count').textContent = `Zug: ${Math.ceil(this.moveHistory.length / 2)}`;
                
                if (this.chess.isGameOver()) {
                    let status = '';
                    if (this.chess.isCheckmate()) {
                        status = this.currentPlayer === 'white' ? 'Schwarz gewinnt!' : 'Weiß gewinnt!';
                    } else if (this.chess.isDraw()) {
                        status = 'Unentschieden!';
                    }
                    document.getElementById('game-status').textContent = status;
                    this.showNotification(status);
                }
            }

            updateUI() {
                const currentPlayerText = this.currentPlayer === 'white' ? 'Weiß ist dran' : 'Schwarz ist dran';
                document.getElementById('current-player').textContent = currentPlayerText;
            }

            updateAIStatus(status) {
                document.getElementById('ai-status').textContent = status;
            }

            setupEventListeners() {
                document.getElementById('new-game').addEventListener('click', () => {
                    this.startNewGame();
                });

                document.getElementById('undo').addEventListener('click', () => {
                    this.undoMove();
                });

                document.getElementById('hint').addEventListener('click', () => {
                    this.showHint();
                });

                document.getElementById('environment').addEventListener('change', (e) => {
                    this.changeEnvironment(e.target.value);
                });

                document.getElementById('board-theme').addEventListener('change', (e) => {
                    this.changeTheme(e.target.value);
                });

                document.getElementById('ai-character').addEventListener('change', (e) => {
                    this.changeAICharacter(e.target.value);
                });

                document.getElementById('robot-type').addEventListener('change', (e) => {
                    this.changeRobotType(e.target.value);
                });
            }

            startNewGame() {
                this.chess.reset();
                this.currentPlayer = 'white';
                this.selectedSquare = null;
                this.moveHistory = [];
                this.aiThinking = false;
                
                document.getElementById('current-player').textContent = 'Weiß ist dran';
                document.getElementById('move-count').textContent = 'Zug: 1';
                document.getElementById('game-status').textContent = 'Spiel läuft';
                document.getElementById('last-move').textContent = 'Keiner';
                
                this.updateBoard();
                this.showNotification('Neues Spiel gestartet!');
            }

            undoMove() {
                if (this.moveHistory.length === 0) {
                    this.showNotification('Keine Züge zum Rückgängigmachen!', 'warning');
                    return;
                }

                const undoneMove = this.chess.undo();
                if (undoneMove) {
                    this.moveHistory.pop();
                    
                    if (this.currentPlayer === 'white') {
                        const aiMove = this.chess.undo();
                        if (aiMove) {
                            this.moveHistory.pop();
                        }
                    } else {
                        this.currentPlayer = 'white';
                    }
                    
                    this.updateBoard();
                    this.updateUI();
                    this.showNotification('Zug rückgängig gemacht');
                    
                    document.getElementById('move-count').textContent = `Zug: ${Math.ceil(this.moveHistory.length / 2)}`;
                    if (this.moveHistory.length > 0) {
                        document.getElementById('last-move').textContent = this.moveHistory[this.moveHistory.length - 1].san;
                    } else {
                        document.getElementById('last-move').textContent = 'Keiner';
                    }
                }
            }

            showHint() {
                const moves = this.chess.moves();
                if (moves.length > 0) {
                    const randomMove = moves[Math.floor(Math.random() * moves.length)];
                    this.showNotification(`Hinweis: Versuchen Sie ${randomMove}`);
                } else {
                    this.showNotification('Keine legalen Züge verfügbar!');
                }
            }

            changeEnvironment(envId) {
                const body = document.body;
                
                // Remove all environment classes
                body.classList.remove('env-space', 'env-cyberpunk', 'env-forest', 'env-underwater', 'env-volcanic');
                
                switch (envId) {
                    case 'space':
                        body.classList.add('env-space');
                        this.showNotification('Umgebung: Weltraum');
                        break;
                    case 'cyberpunk':
                        body.classList.add('env-cyberpunk');
                        this.showNotification('Umgebung: Cyberpunk Stadt');
                        break;
                    case 'forest':
                        body.classList.add('env-forest');
                        this.showNotification('Umgebung: Verzauberter Wald');
                        break;
                    case 'underwater':
                        body.classList.add('env-underwater');
                        this.showNotification('Umgebung: Unterwassertempel');
                        break;
                    case 'volcanic':
                        body.classList.add('env-volcanic');
                        this.showNotification('Umgebung: Vulkanlandschaft');
                        break;
                    default:
                        this.showNotification('Umgebung: Standard');
                        break;
                }
            }

            changeTheme(themeId) {
                const board = document.getElementById('chess-board');
                const squares = document.querySelectorAll('.square');
                
                switch (themeId) {
                    case 'cyberpunk':
                        board.style.borderColor = '#ff00ff';
                        board.style.boxShadow = '0 0 50px rgba(255, 0, 255, 0.5)';
                        squares.forEach(square => {
                            if (square.classList.contains('light')) {
                                square.style.background = '#1a1a2e';
                                square.style.color = '#00ffff';
                            } else {
                                square.style.background = '#0f0f1e';
                                square.style.color = '#ff00ff';
                            }
                        });
                        break;
                    case 'crystal':
                        board.style.borderColor = '#87CEEB';
                        board.style.boxShadow = '0 0 50px rgba(135, 206, 235, 0.5)';
                        squares.forEach(square => {
                            if (square.classList.contains('light')) {
                                square.style.background = 'rgba(255, 255, 255, 0.8)';
                                square.style.color = '#333';
                            } else {
                                square.style.background = 'rgba(135, 206, 235, 0.6)';
                                square.style.color = '#fff';
                            }
                        });
                        break;
                    default: // classic
                        board.style.borderColor = '#00ffff';
                        board.style.boxShadow = '0 0 50px rgba(0, 255, 255, 0.5)';
                        squares.forEach(square => {
                            if (square.classList.contains('light')) {
                                square.style.background = '#f0d9b5';
                                square.style.color = '#333';
                            } else {
                                square.style.background = '#b58863';
                                square.style.color = '#fff';
                            }
                        });
                        break;
                }
                
                this.showNotification(`Theme: ${themeId}`);
            }

            changeAICharacter(characterId) {
                const characters = {
                    'neon-hacker': { name: 'Neon Hacker', emoji: '🕴️', color: '#00ffff' },
                    'cyber-warrior': { name: 'Cyber Warrior', emoji: '⚔️', color: '#ff6600' },
                    'data-ghost': { name: 'Data Ghost', emoji: '👻', color: '#9400d3' },
                    'chrome-knight': { name: 'Chrome Knight', emoji: '🏰', color: '#c0c0c0' }
                };
                
                const character = characters[characterId];
                if (character) {
                    document.getElementById('ai-avatar').textContent = character.name;
                    const robotEmoji = document.getElementById('ai-visual').textContent.slice(-2);
                    document.getElementById('ai-visual').textContent = character.emoji + robotEmoji;
                    document.getElementById('ai-visual').style.color = character.color;
                    this.showNotification(`AI: ${character.name}`);
                }
            }

            changeRobotType(robotType) {
                const robots = {
                    'humanoid': { name: 'Humanoid Android', emoji: '🤖' },
                    'tactical': { name: 'Taktische Einheit', emoji: '🦾' },
                    'combat': { name: 'Kampf Drohne', emoji: '🚁' },
                    'stealth': { name: 'Stealth Bot', emoji: '🥷' }
                };
                
                const robot = robots[robotType];
                if (robot) {
                    document.getElementById('ai-robot-type').textContent = robot.name;
                    const characterEmoji = document.getElementById('ai-visual').textContent.slice(0, -2);
                    document.getElementById('ai-visual').textContent = characterEmoji + robot.emoji;
                    this.showNotification(`Roboter: ${robot.name}`);
                }
            }

            showNotification(message, type = 'info') {
                console.log('Benachrichtigung:', message);
                
                const notification = document.createElement('div');
                notification.textContent = message;
                
                const color = type === 'error' ? '#ff0000' : type === 'warning' ? '#ffaa00' : '#00ffff';
                notification.style.cssText = `
                    position: fixed;
                    top: 50px;
                    right: 20px;
                    background: rgba(0, 0, 0, 0.9);
                    color: white;
                    padding: 15px 20px;
                    border-radius: 5px;
                    border-left: 4px solid ${color};
                    z-index: 10000;
                    max-width: 300px;
                    font-size: 14px;
                    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
                    transform: translateX(100%);
                    transition: transform 0.3s ease;
                `;
                
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.style.transform = 'translateX(0)';
                }, 100);
                
                setTimeout(() => {
                    notification.style.transform = 'translateX(100%)';
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.parentNode.removeChild(notification);
                        }
                    }, 300);
                }, 3000);
            }
        }

        // Initialize when page loads
        window.addEventListener('load', () => {
            console.log('Seite geladen, starte Spiel...');
            window.chessGame = new PerfektesSchach();
        });
    </script>
</body>
</html>